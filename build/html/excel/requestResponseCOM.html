

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Buy-Side Request/Response Service (COM) &mdash; EMSX API Programmers Guide 0.0.5 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="EMSX API Programmers Guide 0.0.5 documentation" href="../index.html"/>
        <link rel="up" title="Excel COM" href="index.html"/>
        <link rel="next" title="Sell-Side Request/Response Service (COM)" href="requestResponseSsCOM.html"/>
        <link rel="prev" title="Excel COM" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> EMSX API Programmers Guide
          

          
          </a>

          
            
            
              <div class="version">
                0.0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/index.html">Server Side EMSX API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programmable/index.html">Programmable EMSX API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Excel COM</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Buy-Side Request/Response Service (COM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description-of-request-response-service">Description of Request/Response Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cfd-odd-lot-flag">CFD &amp; Odd Lot Flag</a></li>
<li class="toctree-l3"><a class="reference internal" href="#date-time-format">Date &amp; Time Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custome-notes-free-text-fields">Custome Notes &amp; Free Text Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assign-trader-request-com">Assign Trader Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cancel-route-request-com">Cancel Route Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-order-and-route-extended-request-com">Create Order And Route Extended Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-order-and-route-manually-extended-request-com">Create Order And Route Manually Extended Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-order-request-com">Create Order Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#delete-order-request-com">Delete Order Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#emsx-history-service-com">EMSX History Service (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-all-field-meta-data-request-com">Get All Field Meta Data Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-broker-strategies-with-asset-class-request-com">Get Broker Strategies With Asset Class Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-broker-strategy-infor-with-asset-class-request-com">Get Broker Strategy Infor With Asset Class Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-brokers-with-asset-class-request-com">Get Brokers With Asset Class Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-field-meta-data-request-com">Get Field Meta Data Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-teams-request-com">Get Teams Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#group-route-request-com">Group Route Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#route-extended-request-com">Route Extended Request (COM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#route-manually-request-com">Route Manually Request (COM)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="requestResponseSsCOM.html">Sell-Side Request/Response Service (COM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="emsxSubscriptionCom.html">EMSX Subscription (COM)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">EMSX API Programmers Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Excel COM</a> &raquo;</li>
      
    <li>Buy-Side Request/Response Service (COM)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/excel/requestResponseCom.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="buy-side-request-response-service-com">
<h1>Buy-Side Request/Response Service (COM)<a class="headerlink" href="#buy-side-request-response-service-com" title="Permalink to this headline">¶</a></h1>
<p>The EMSX API allows developers to use the Request/Response services for order and route creation, modification, queries related to orders and routes (placements) as well as EMSX Team details. Depending on the type of action required, the application programmer must create a specific request, populate it with required parameters and send that request to the EMSX API service, which provides the response. Communication with the request/response service requires the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Create a session (if session does not yet exist).</li>
<li>Connect session to <code class="docutils literal"><span class="pre">//blp/emapisvc_beta</span></code> or <code class="docutils literal"><span class="pre">//blp/emapisvc</span></code> service and start it.</li>
<li>Fetch a service object from the session representing emapisvc.</li>
<li>Use the service object from above to create a Request object of the desired type</li>
<li>Send request object via sendRequest method of session object, pass object of type EventQueue to the sendRequest.</li>
<li>Loop through the EventQueue object until event of type <code class="docutils literal"><span class="pre">Event::RESPONSE</span></code> is read.</li>
</ol>
</div></blockquote>
<p>These are initialized in the constructor as below and are then available for the life of the application for submission of various requests.</p>
<div class="section" id="description-of-request-response-service">
<h2>Description of Request/Response Service<a class="headerlink" href="#description-of-request-response-service" title="Permalink to this headline">¶</a></h2>
<p>EMSX API supports the following Request/Response services:-</p>
<p><em>Please note, the descriptions to the legacy request/response services are omitted from the description section.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Request Name</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AssignTrader</td>
<td>Assign an order to another UUID</td>
</tr>
<tr class="row-odd"><td>CancelRouteEX</td>
<td>Cancel outstanding routes (placements)</td>
</tr>
<tr class="row-even"><td>CreateOrder</td>
<td>Create an order or stage an order into EMSX&lt;GO&gt;</td>
</tr>
<tr class="row-odd"><td>CreateOrderAndRouteEx</td>
<td>Create a new order and route in a single request.</td>
</tr>
<tr class="row-even"><td>CreateOrderAndRouteManually</td>
<td>Create the order and notify EMSX this is routed.</td>
</tr>
<tr class="row-odd"><td>DeleteOrder</td>
<td>Delete an existing order in EMSX&lt;GO&gt;</td>
</tr>
<tr class="row-even"><td>GetAllFieldMetaData</td>
<td>Get all field meta data in a response message</td>
</tr>
<tr class="row-odd"><td>GetAssetClass</td>
<td>Get all asset class data in a response message</td>
</tr>
<tr class="row-even"><td>GetBrokers</td>
<td>Get all broker data in a response message</td>
</tr>
<tr class="row-odd"><td>GetBrokerStrategies</td>
<td>Get all broker strategy data in a response message</td>
</tr>
<tr class="row-even"><td>GetBrokerStrategiesWithAssetClass</td>
<td>Get all broker strategy information and asset class data</td>
</tr>
<tr class="row-odd"><td>GetBrokerStrategyInfo</td>
<td>Get all broker strategy info data in a response message</td>
</tr>
<tr class="row-even"><td>GetBrokerStrategyInfoWithAssetClass</td>
<td>Get all broker strategy info and asset class data</td>
</tr>
<tr class="row-odd"><td>GetBrokerWithAssetClass</td>
<td>Get all broker data with asset class in a response message</td>
</tr>
<tr class="row-even"><td>GetFieldMetaData</td>
<td>Get field meta data in a reponse message</td>
</tr>
<tr class="row-odd"><td>GetTeams</td>
<td>Get team data in a response message</td>
</tr>
<tr class="row-even"><td>GroupRouteEx</td>
<td>Submit the entire list as a single route to a basket algorithm</td>
</tr>
<tr class="row-odd"><td>ModifyOrder</td>
<td>Modify parent order</td>
</tr>
<tr class="row-even"><td>ModifyRouteEx</td>
<td>Modify child route</td>
</tr>
<tr class="row-odd"><td>RouteEx</td>
<td>Route existing order</td>
</tr>
<tr class="row-even"><td>RouteManuallyEx</td>
<td>Route manually and notify EMSX that it is routed.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="docutils literal"><span class="pre">CreateOrderAndRouteEx</span></code> can be used for both strategy and non-strategy broker destinations.</p>
<p><code class="docutils literal"><span class="pre">CreateOrderAndRouteManually</span></code> is generally used for phone orders to brokers, where the actual placement is outside of EMSX&lt;GO&gt;.</p>
<p><code class="docutils literal"><span class="pre">RouteEx</span></code> can be used for both strategy and non-strategy broker destinations.</p>
<p><code class="docutils literal"><span class="pre">RouteManuallyEx</span></code> is generally used for phone orders to manually enter back the execution to EMSX&lt;GO&gt;.</p>
<p><code class="docutils literal"><span class="pre">SellSideAck</span></code> is used for EMSX to EMSX or E2E settings where sell-side EMSX&lt;GO&gt; is used to receive order from buy-side EMSX.</p>
<p class="last"><code class="docutils literal"><span class="pre">SellSideReject</span></code> is used for EMSX to EMSX or E2E settings where sell-side EMSX&lt;GO&gt; is used to receive order from buy-side EMSX.</p>
</div>
</div>
<div class="section" id="cfd-odd-lot-flag">
<h2>CFD &amp; Odd Lot Flag<a class="headerlink" href="#cfd-odd-lot-flag" title="Permalink to this headline">¶</a></h2>
<p>This is a feature that indicates CFD orders or to flag an odd lot in EMSX API.</p>
<p><code class="docutils literal"><span class="pre">EMSX_CFD_FLAG</span></code>  is used to flag a particular order as CFD</p>
<blockquote>
<div><ul class="simple">
<li>0 = not flagged</li>
<li>1 = flagged</li>
</ul>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">EMSX_ODD_LOT_FLAG</span></code>  is an odd lot is a quantity of stock that is less than 100 shares. A deal involving 100 shares or more is considered a round-lot transactions.</p>
<blockquote>
<div><ul class="simple">
<li>0 = not an odd lot / it won&#8217;t fill odd lots</li>
<li>1 = odd lot</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="date-time-format">
<h2>Date &amp; Time Format<a class="headerlink" href="#date-time-format" title="Permalink to this headline">¶</a></h2>
<p>All date format except <code class="docutils literal"><span class="pre">EMSX_QUEUED_TIME</span></code> are in yyyymmdd format. All time format except <code class="docutils literal"><span class="pre">EMSX_STRATEGY_END_TIME</span></code> and <code class="docutils literal"><span class="pre">EMSX_STRATEGY_START_TIME</span></code> are in number of seconds from midnight.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_GTD_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_LAST_FILL_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_QUEUED_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_ROUTE_CREATE_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_SETTLE_DATE</span></code></td>
<td>yyyymmdd</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_QUEUED_TIME</span></code></td>
<td>hhmm</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_STRATEGY_END_TIME</span></code></td>
<td>hhmmss</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_STRATEGY_START_TIME</span></code></td>
<td>hhmmss</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_LAST_FILL_TIME</span></code></td>
<td>Number of seconds from midnight</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_ROUTE_CREATE_TIME</span></code></td>
<td>Number of seconds from midnight</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_ROUTE_LAST_UPDATE_TIME</span></code></td>
<td>Number of seconds from midnight</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_TIME_STAMP</span></code></td>
<td>Number of seconds from midnight</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">//blp/emsx.history</span></code> and <code class="docutils literal"><span class="pre">//blp/emsx.history.uat</span></code> are set in date time objects unlike the <code class="docutils literal"><span class="pre">//blp/emapisvc</span></code> or <code class="docutils literal"><span class="pre">//blp/emapisvc_beta.</span></code></p>
</div>
<div class="section" id="custome-notes-free-text-fields">
<h2>Custome Notes &amp; Free Text Fields<a class="headerlink" href="#custome-notes-free-text-fields" title="Permalink to this headline">¶</a></h2>
<p>The EMSX API provides several different EMSX options for entering and using free text fields. Some of these free text fields can be used for an internal only workflow where the others can be used to communicate with the various execution counterparts.</p>
<p>The following elements are available on order and/or route subscription services. These elements will be passed to the external trading counterparts.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_ACCOUNT</span></code></td>
<td>30-character free text field (29+1 check digit), FIX Tag 1</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_NOTE</span></code></td>
<td>44-character free text field (43+1 check digit), FIX Tag 58</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_ORDER_REF_ID</span></code></td>
<td>16-character field (15+1 check digit) <em>order subscription only</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_ROUTE_REF_ID</span></code></td>
<td>16-character field (15+1 check digit) <em>route subscription only</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_TRADER_NOTES</span></code></td>
<td>44-character free text field (43+1 check digit), <strong>internal only</strong></td>
</tr>
</tbody>
</table>
<p>The following elements are available only for internal fields unless custom mapped to a custom FIX tag to a particular trading counterparty.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>The following elements are not available on either order or route subscription service.</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_CUSTOM_NOTE1</span></code></td>
<td>80-character free text field (79+1 check digit)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_CUSTOM_NOTE2</span></code></td>
<td>80-character free text field (79+1 check digit)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_CUSTOM_NOTE3</span></code></td>
<td>80-character free text field (79+1 check digit)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">EMSX_CUSTOM_NOTE4</span></code></td>
<td>80-character free text field (79+1 check digit)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">EMSX_CUSTOM_NOTE5</span></code></td>
<td>80-character free text field (79+1 check digit)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="assign-trader-request-com">
<h2>Assign Trader Request (COM)<a class="headerlink" href="#assign-trader-request-com" title="Permalink to this headline">¶</a></h2>
<p>AssignTrader request allows EMSX API to reassign order to another user UUID. A typical setup will have the different UUID as another part of the TEAM setup for the order creater UUID. This will allow systematically generated trades to be reassigned to another human trader if need be from the EMSX API.</p>
<p>Assigned trader must be in same EMBR group for this to work. EMBR&lt;GO&gt; is an internal Bloomberg function the EMSX account managers will use to set this feature on behalf of the client. The EMSX account manager will check off the ability to reassign before the AssignTrader request will work. Once this feature is on, trading on behalf other UUID feature will no longer work for that team.</p>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - AssignTrader&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;AssignTrader&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1</span>

            <span class="c">&#39; Append the order numbers...</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Append</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741104</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Append</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741105</span>

            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ASSIGNEE_TRADER_UUID&quot;</span><span class="p">,</span> <span class="mi">12109783</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">successful</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">failed</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">order</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>
    <span class="k">Dim</span> <span class="n">success</span> <span class="ow">As</span> <span class="kt">Boolean</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;AssignTrader&quot;</span> <span class="k">Then</span>

                <span class="n">success</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ALL_SUCCESS&quot;</span><span class="p">)</span>

                <span class="k">If</span> <span class="n">success</span> <span class="k">Then</span>

                    <span class="n">log</span> <span class="s">&quot;All orders successfully assigned&quot;</span>

                    <span class="k">Set</span> <span class="n">successful</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ASSIGN_TRADER_SUCCESSFUL_ORDERS&quot;</span><span class="p">)</span>

                    <span class="n">numValues</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">numValues</span>

                    <span class="k">If</span> <span class="n">numValues</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="n">log</span> <span class="s">&quot;Successful assignments:-&quot;</span>

                    <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                        <span class="k">Set</span> <span class="n">order</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                        <span class="n">log</span> <span class="n">order</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>

                    <span class="k">Next</span> <span class="n">i</span>

                <span class="k">Else</span>

                    <span class="n">log</span> <span class="s">&quot;One or more failed assignments...&quot;</span>

                    <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">AsElement</span><span class="p">.</span><span class="n">HasElement</span><span class="p">(</span><span class="s">&quot;EMSX_ASSIGN_TRADER_SUCCESSFUL_ORDERS&quot;</span><span class="p">)</span> <span class="k">Then</span>

                        <span class="k">Set</span> <span class="n">successful</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ASSIGN_TRADER_SUCCESSFUL_ORDERS&quot;</span><span class="p">)</span>

                        <span class="n">numValues</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">numValues</span>

                        <span class="k">If</span> <span class="n">numValues</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="n">log</span> <span class="s">&quot;Successful assignments:-&quot;</span>

                        <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                            <span class="k">Set</span> <span class="n">order</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                            <span class="n">log</span> <span class="n">order</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>

                        <span class="k">Next</span> <span class="n">i</span>

                    <span class="k">End</span> <span class="k">If</span>

                    <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">AsElement</span><span class="p">.</span><span class="n">HasElement</span><span class="p">(</span><span class="s">&quot;EMSX_ASSIGN_TRADER_FAILED_ORDERS&quot;</span><span class="p">)</span> <span class="k">Then</span>

                        <span class="k">Set</span> <span class="n">successful</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ASSIGN_TRADER_FAILED_ORDERS&quot;</span><span class="p">)</span>

                        <span class="n">numValues</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">numValues</span>

                        <span class="k">If</span> <span class="n">numValues</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="n">log</span> <span class="s">&quot;Failed assignments:-&quot;</span>

                        <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                            <span class="k">Set</span> <span class="n">order</span> <span class="o">=</span> <span class="n">successful</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                            <span class="n">log</span> <span class="n">order</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>

                        <span class="k">Next</span> <span class="n">i</span>

                    <span class="k">End</span> <span class="k">If</span>
                <span class="k">End</span> <span class="k">If</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="cancel-route-request-com">
<h2>Cancel Route Request (COM)<a class="headerlink" href="#cancel-route-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - CancelRoute&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">routes</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">Route</span> <span class="ow">As</span> <span class="n">Element</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;CancelRoute&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1</span>
            <span class="c">&#39;req.Set &quot;EMSX_TRADER_UUID&quot;, 1234567</span>

            <span class="k">Set</span> <span class="n">routes</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ROUTES&quot;</span><span class="p">)</span>   <span class="c">&#39;Note, the case is important</span>
            <span class="k">Set</span> <span class="n">Route</span> <span class="o">=</span> <span class="n">routes</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">()</span>

            <span class="n">Route</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741104</span>
            <span class="n">Route</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;CancelRoute&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">stat</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">stat</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;STATUS&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;STATUS: &quot;</span> <span class="o">&amp;</span> <span class="n">stat</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="create-order-and-route-extended-request-com">
<h2>Create Order And Route Extended Request (COM)<a class="headerlink" href="#create-order-and-route-extended-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - CreateOrderAndRoute&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;CreateOrderAndRouteEx&quot;</span><span class="p">)</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT&quot;</span><span class="p">,</span> <span class="mi">1000</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_SIDE&quot;</span><span class="p">,</span> <span class="s">&quot;BUY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BOOKNAME&quot;, &quot;HedgingBasket&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BASKET_NAME&quot;, &quot;HedgingBasket&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE1&quot;, &quot;Note1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE2&quot;, &quot;Note2&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE3&quot;, &quot;Note3&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE4&quot;, &quot;Note4&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE5&quot;, &quot;Note5&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXCHANGE_DESTINATION&quot;, &quot;ExchDest&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_INVESTOR_ID&quot;, &quot;InvID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_ORIGIN&quot;, &quot;&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_ROUTE_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_CURRENCY&quot;, &quot;USD&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_DATE&quot;, 20170106</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_TYPE&quot;, &quot;T+2&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;CreateOrderAndRouteEx&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">emsxRouteId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                <span class="n">emsxRouteId</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;EMSX_SEQUENCE: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;    EMSX_ROUTE_ID: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxRouteId</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="create-order-and-route-manually-extended-request-com">
<h2>Create Order And Route Manually Extended Request (COM)<a class="headerlink" href="#create-order-and-route-manually-extended-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - CreateOrderAndRouteManually&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;CreateOrderAndRouteManually&quot;</span><span class="p">)</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT&quot;</span><span class="p">,</span> <span class="mi">1000</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_SIDE&quot;</span><span class="p">,</span> <span class="s">&quot;BUY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXCHANGE_DESTINATION&quot;, &quot;ExchDest&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_INVESTOR_ID&quot;, &quot;InvID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_ORIGIN&quot;, &quot;&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_DATE&quot;, 20170106</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;CreateOrderAndRouteManually&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">emsxRouteId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                <span class="n">emsxRouteId</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;EMSX_SEQUENCE: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;    EMSX_ROUTE_ID: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxRouteId</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="create-order-request-com">
<h2>Create Order Request (COM)<a class="headerlink" href="#create-order-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - CreateOrder&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;CreateOrder&quot;</span><span class="p">)</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT&quot;</span><span class="p">,</span> <span class="mi">1000</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_SIDE&quot;</span><span class="p">,</span> <span class="s">&quot;BUY&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BASKET_NAME&quot;, &quot;HedgingBasket&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE1&quot;, &quot;Note1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE2&quot;, &quot;Note2&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE3&quot;, &quot;Note3&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE4&quot;, &quot;Note4&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CUSTOM_NOTE5&quot;, &quot;Note5&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXCHANGE_DESTINATION&quot;, &quot;ExchDest&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_INVESTOR_ID&quot;, &quot;InvID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_ORIGIN&quot;, &quot;&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_CURRENCY&quot;, &quot;USD&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_DATE&quot;, 20170106</span>
            <span class="c">&#39;req.Set &quot;EMSX_SETTLE_TYPE&quot;, &quot;T+2&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;CreateOrder&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;EMSX_SEQUENCE: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-order-request-com">
<h2>Delete Order Request (COM)<a class="headerlink" href="#delete-order-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - DeleteOrder&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;DeleteOrder&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">).</span><span class="n">AppendValue</span> <span class="mi">3741181</span>
            <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">).</span><span class="n">AppendValue</span> <span class="mi">3741182</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;DeleteOrder&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">stat</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">stat</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;STATUS&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;STATUS: &quot;</span> <span class="o">&amp;</span> <span class="n">stat</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="emsx-history-service-com">
<h2>EMSX History Service (COM)<a class="headerlink" href="#emsx-history-service-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxHistoryService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - EMSXHistory&quot;</span>

    <span class="n">emsxHistoryService</span> <span class="o">=</span> <span class="s">&quot;//blp/emsx.history.uat&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxHistoryService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">scope</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">filter</span> <span class="ow">As</span> <span class="n">Element</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxHistoryService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetFills&quot;</span><span class="p">)</span>

            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;FromDateTime&quot;</span><span class="p">,</span> <span class="s">&quot;2017-02-08T00:00:00.000+00:00&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;ToDateTime&quot;</span><span class="p">,</span> <span class="s">&quot;2017-02-11T23:59:00.000+00:00&quot;</span>

            <span class="k">Set</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Scope&quot;</span><span class="p">)</span>

            <span class="c">&#39;scope.SetChoice &quot;Team&quot;</span>
            <span class="c">&#39;scope.SetChoice &quot;TradingSystem&quot;</span>
            <span class="n">scope</span><span class="p">.</span><span class="n">SetChoice</span> <span class="s">&quot;Uuids&quot;</span>

            <span class="c">&#39;scope.SetElement &quot;Team&quot;, &quot;SEXEGROUP&quot;</span>
            <span class="c">&#39;scope.SetElement &quot;TradingSystem&quot;, False</span>

            <span class="n">scope</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Uuids&quot;</span><span class="p">).</span><span class="n">AppendValue</span> <span class="mi">8049857</span>
            <span class="c">&#39;scope.GetElement(&quot;Uuids&quot;).AppendValue 1234567</span>
            <span class="c">&#39;scope.GetElement(&quot;Uuids&quot;).AppendValue 1234568</span>
            <span class="c">&#39;scope.GetElement(&quot;Uuids&quot;).AppendValue 1234569</span>

            <span class="c">&#39;Set filter = req.GetElement(&quot;FilterBy&quot;)</span>

            <span class="c">&#39;filter.SetChoice &quot;Basket&quot;</span>
            <span class="c">&#39;filter.SetChoice &quot;Multileg&quot;</span>
            <span class="c">&#39;filter.SetChoice &quot;OrdersAndRoutes&quot;</span>

            <span class="c">&#39;filter.GetElement(&quot;Basket&quot;).AppendValue &quot;TESTRJC&quot;</span>
            <span class="c">&#39;filter.GetElement(&quot;Multileg&quot;).AppendValue &quot;mylegId&quot;</span>

            <span class="c">&#39;Dim newOrder As Element</span>

            <span class="c">&#39;Set newOrder = filter.GetElement(&quot;OrdersAndRoutes&quot;).AppendElement()</span>
            <span class="c">&#39;newOrder.SetElement &quot;OrderId&quot;, 4292580</span>
            <span class="c">&#39;newOrder.SetElement &quot;RouteId&quot;, 1</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetFillsResponse&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">fills</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">fill</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">numFills</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">account</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">amount</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">assetClass</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">basketId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">bbgid</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">blockId</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">broker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">clearingAccount</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">clearingFirm</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">contractExpDate</span> <span class="ow">As</span> <span class="kt">Date</span>
                <span class="k">Dim</span> <span class="n">correctedFillId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">crncy</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">cusip</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">dateTimeOfFill</span> <span class="ow">As</span> <span class="kt">Date</span>
                <span class="k">Dim</span> <span class="n">exchange</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">execPrevSeqNo</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">execType</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">executingBroker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">fillId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">fillPrice</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">fillShares</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">investorId</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">isCFD</span> <span class="ow">As</span> <span class="kt">Boolean</span>
                <span class="k">Dim</span> <span class="n">isin</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">isLeg</span> <span class="ow">As</span> <span class="kt">Boolean</span>
                <span class="k">Dim</span> <span class="n">lastCapacity</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">lastMarket</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">limitPrice</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">liquidity</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">localExchangeSymbol</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">locateBroker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">locateId</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">locateRequired</span> <span class="ow">As</span> <span class="kt">Boolean</span>
                <span class="k">Dim</span> <span class="n">multiLedId</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">occSymbol</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">orderExecutionInstruction</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">orderHandlingInstruction</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">orderId</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">orderInstruction</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">orderOrigin</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">orderReferenceId</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">originatingTraderUUId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">reroutedBroker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">routeCommissionAmount</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">routeCommissionRate</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">routeExecutionInstruction</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">routeHandlingInstruction</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">routeId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">routeNetMoney</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">routeNotes</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">routeShares</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">securityName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">sedol</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">settlementDate</span> <span class="ow">As</span> <span class="kt">Date</span>
                <span class="k">Dim</span> <span class="n">side</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">stopPrice</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">strategyType</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">ticker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">tif</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">traderName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">traderUUId</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">typ</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">userCommissionAmount</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">userCommissionRate</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">userFees</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">userNetMoney</span> <span class="ow">As</span> <span class="kt">Double</span>
                <span class="k">Dim</span> <span class="n">yellowKey</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="k">Set</span> <span class="n">fills</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Fills&quot;</span><span class="p">)</span>

                <span class="n">numFills</span> <span class="o">=</span> <span class="n">fills</span><span class="p">.</span><span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numFills</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="k">Set</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">fills</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">account</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Account&quot;</span><span class="p">)</span>
                    <span class="n">amount</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Amount&quot;</span><span class="p">)</span>
                    <span class="n">assetClass</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;AssetClass&quot;</span><span class="p">)</span>
                    <span class="n">basketId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;BasketId&quot;</span><span class="p">)</span>
                    <span class="n">bbgid</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;BBGID&quot;</span><span class="p">)</span>
                    <span class="n">blockId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;BlockId&quot;</span><span class="p">)</span>
                    <span class="n">broker</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Broker&quot;</span><span class="p">)</span>
                    <span class="n">clearingAccount</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ClearingAccount&quot;</span><span class="p">)</span>
                    <span class="n">clearingFirm</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ClearingFirm&quot;</span><span class="p">)</span>
                    <span class="n">contractExpDate</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ContractExpDate&quot;</span><span class="p">)</span>
                    <span class="n">correctedFillId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;CorrectedFillId&quot;</span><span class="p">)</span>
                    <span class="n">crncy</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Currency&quot;</span><span class="p">)</span>
                    <span class="n">cusip</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Cusip&quot;</span><span class="p">)</span>
                    <span class="n">dateTimeOfFill</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;DateTimeOfFill&quot;</span><span class="p">)</span>
                    <span class="n">exchange</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Exchange&quot;</span><span class="p">)</span>
                    <span class="n">execPrevSeqNo</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ExecPrevSeqNo&quot;</span><span class="p">)</span>
                    <span class="n">execType</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ExecType&quot;</span><span class="p">)</span>
                    <span class="n">executingBroker</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ExecutingBroker&quot;</span><span class="p">)</span>
                    <span class="n">fillId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;FillId&quot;</span><span class="p">)</span>
                    <span class="n">fillPrice</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;FillPrice&quot;</span><span class="p">)</span>
                    <span class="n">fillShares</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;FillShares&quot;</span><span class="p">)</span>
                    <span class="n">investorId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;InvestorID&quot;</span><span class="p">)</span>
                    <span class="n">isCFD</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;IsCfd&quot;</span><span class="p">)</span>
                    <span class="n">isin</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Isin&quot;</span><span class="p">)</span>
                    <span class="n">isLeg</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;IsLeg&quot;</span><span class="p">)</span>
                    <span class="n">lastCapacity</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LastCapacity&quot;</span><span class="p">)</span>
                    <span class="n">lastMarket</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LastMarket&quot;</span><span class="p">)</span>
                    <span class="n">limitPrice</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LimitPrice&quot;</span><span class="p">)</span>
                    <span class="n">liquidity</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Liquidity&quot;</span><span class="p">)</span>
                    <span class="n">localExchangeSymbol</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LocalExchangeSymbol&quot;</span><span class="p">)</span>
                    <span class="n">locateBroker</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LocateBroker&quot;</span><span class="p">)</span>
                    <span class="n">locateId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LocateId&quot;</span><span class="p">)</span>
                    <span class="n">locateRequired</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;LocateRequired&quot;</span><span class="p">)</span>
                    <span class="n">multiLedId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MultilegId&quot;</span><span class="p">)</span>
                    <span class="n">occSymbol</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OCCSymbol&quot;</span><span class="p">)</span>
                    <span class="n">orderExecutionInstruction</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderExecutionInstruction&quot;</span><span class="p">)</span>
                    <span class="n">orderHandlingInstruction</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderHandlingInstruction&quot;</span><span class="p">)</span>
                    <span class="n">orderId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderId&quot;</span><span class="p">)</span>
                    <span class="n">orderInstruction</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderInstruction&quot;</span><span class="p">)</span>
                    <span class="n">orderOrigin</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderOrigin&quot;</span><span class="p">)</span>
                    <span class="n">orderReferenceId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OrderReferenceId&quot;</span><span class="p">)</span>
                    <span class="n">originatingTraderUUId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;OriginatingTraderUuid&quot;</span><span class="p">)</span>
                    <span class="n">reroutedBroker</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ReroutedBroker&quot;</span><span class="p">)</span>
                    <span class="n">routeCommissionAmount</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteCommissionAmount&quot;</span><span class="p">)</span>
                    <span class="n">routeCommissionRate</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteCommissionRate&quot;</span><span class="p">)</span>
                    <span class="n">routeExecutionInstruction</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteExecutionInstruction&quot;</span><span class="p">)</span>
                    <span class="n">routeHandlingInstruction</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteHandlingInstruction&quot;</span><span class="p">)</span>
                    <span class="n">routeId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteId&quot;</span><span class="p">)</span>
                    <span class="n">routeNetMoney</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteNetMoney&quot;</span><span class="p">)</span>
                    <span class="n">routeNotes</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteNotes&quot;</span><span class="p">)</span>
                    <span class="n">routeShares</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;RouteShares&quot;</span><span class="p">)</span>
                    <span class="n">securityName</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;SecurityName&quot;</span><span class="p">)</span>
                    <span class="n">sedol</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Sedol&quot;</span><span class="p">)</span>
                    <span class="n">settlementDate</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;SettlementDate&quot;</span><span class="p">)</span>
                    <span class="n">side</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Side&quot;</span><span class="p">)</span>
                    <span class="n">stopPrice</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;StopPrice&quot;</span><span class="p">)</span>
                    <span class="n">strategyType</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;StrategyType&quot;</span><span class="p">)</span>
                    <span class="n">ticker</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Ticker&quot;</span><span class="p">)</span>
                    <span class="n">tif</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;TIF&quot;</span><span class="p">)</span>
                    <span class="n">traderName</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;TraderName&quot;</span><span class="p">)</span>
                    <span class="n">traderUUId</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;TraderUuid&quot;</span><span class="p">)</span>
                    <span class="n">typ</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Type&quot;</span><span class="p">)</span>
                    <span class="n">userCommissionAmount</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;UserCommissionAmount&quot;</span><span class="p">)</span>
                    <span class="n">userCommissionRate</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;UserCommissionRate&quot;</span><span class="p">)</span>
                    <span class="n">userFees</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;UserFees&quot;</span><span class="p">)</span>
                    <span class="n">userNetMoney</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;UserNetMoney&quot;</span><span class="p">)</span>
                    <span class="n">yellowKey</span> <span class="o">=</span> <span class="n">fill</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;YellowKey&quot;</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;OrderId: &quot;</span> <span class="o">&amp;</span> <span class="n">orderId</span> <span class="o">&amp;</span> <span class="s">&quot;    Fill ID: &quot;</span> <span class="o">&amp;</span> <span class="n">fillId</span> <span class="o">&amp;</span> <span class="s">&quot;    Date/Time: &quot;</span> <span class="o">&amp;</span> <span class="n">dateTimeOfFill</span> <span class="o">&amp;</span> <span class="s">&quot;    Shares: &quot;</span> <span class="o">&amp;</span> <span class="n">fillShares</span> <span class="o">&amp;</span> <span class="s">&quot;    Price: &quot;</span> <span class="o">&amp;</span> <span class="n">fillPrice</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-all-field-meta-data-request-com">
<h2>Get All Field Meta Data Request (COM)<a class="headerlink" href="#get-all-field-meta-data-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetAllFieldMetaData&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetAllFieldMetaData&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetAllFieldMetaData&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">md</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">emsxFieldName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxDispName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxType</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxLevel</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">emsxLen</span> <span class="ow">As</span> <span class="kt">Integer</span>

                <span class="k">Set</span> <span class="n">md</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MetaData&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="k">Set</span> <span class="n">e</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">emsxFieldName</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_FIELD_NAME&quot;</span><span class="p">)</span>
                    <span class="n">emsxDispName</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_DISP_NAME&quot;</span><span class="p">)</span>
                    <span class="n">emsxType</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_TYPE&quot;</span><span class="p">)</span>
                    <span class="n">emsxLevel</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_LEVEL&quot;</span><span class="p">)</span>
                    <span class="n">emsxLen</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_LEN&quot;</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;MetaData: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxFieldName</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxDispName</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxType</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxLevel</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxLen</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-broker-strategies-with-asset-class-request-com">
<h2>Get Broker Strategies With Asset Class Request (COM)<a class="headerlink" href="#get-broker-strategies-with-asset-class-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetBrokerStrategiesWithAssetClass&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetBrokerStrategiesWithAssetClass&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ASSET_CLASS&quot;</span><span class="p">,</span> <span class="s">&quot;EQTY&quot;</span>  <span class="c">&#39;one of EQTY, OPT, FUT or MULTILEG_OPT</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BMTB&quot;</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetBrokerStrategiesWithAssetClass&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">strategies</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">strategy</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>

                <span class="k">Set</span> <span class="n">strategies</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGIES&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">strategies</span><span class="p">.</span><span class="n">numValues</span>

                <span class="n">log</span> <span class="s">&quot;Number of strategies: &quot;</span> <span class="o">&amp;</span> <span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategies</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">log</span> <span class="s">&quot;Strategy: &quot;</span> <span class="o">&amp;</span> <span class="n">strategy</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-broker-strategy-infor-with-asset-class-request-com">
<h2>Get Broker Strategy Infor With Asset Class Request (COM)<a class="headerlink" href="#get-broker-strategy-infor-with-asset-class-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetBrokerStrategyInfoWithAssetClass&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetBrokerStrategyInfoWithAssetClass&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ASSET_CLASS&quot;</span><span class="p">,</span> <span class="s">&quot;EQTY&quot;</span>  <span class="c">&#39;one of EQTY, OPT, FUT or MULTILEG_OPT</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BMTB&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_STRATEGY&quot;</span><span class="p">,</span> <span class="s">&quot;VWAP&quot;</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetBrokerStrategyInfoWithAssetClass&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">strategies</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">fieldName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">disable</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">stringValue</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="k">Set</span> <span class="n">strategies</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_INFO&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">strategies</span><span class="p">.</span><span class="n">numValues</span>

                <span class="n">log</span> <span class="s">&quot;Number of strategies: &quot;</span> <span class="o">&amp;</span> <span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="k">Set</span> <span class="n">e</span> <span class="o">=</span> <span class="n">strategies</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">fieldName</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;FieldName&quot;</span><span class="p">)</span>
                    <span class="n">disable</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;Disable&quot;</span><span class="p">)</span>
                    <span class="n">stringValue</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;StringValue&quot;</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;Strategy Info: &quot;</span> <span class="o">&amp;</span> <span class="n">fieldName</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">disable</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">stringValue</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-brokers-with-asset-class-request-com">
<h2>Get Brokers With Asset Class Request (COM)<a class="headerlink" href="#get-brokers-with-asset-class-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetBrokersWithAssetClass&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetBrokersWithAssetClass&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ASSET_CLASS&quot;</span><span class="p">,</span> <span class="s">&quot;EQTY&quot;</span>  <span class="c">&#39;one of EQTY, OPT, FUT or MULTILEG_OPT</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetBrokersWithAssetClass&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">brokers</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">broker</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>

                <span class="k">Set</span> <span class="n">brokers</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_BROKERS&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">brokers</span><span class="p">.</span><span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="n">broker</span> <span class="o">=</span> <span class="n">brokers</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;Broker: &quot;</span> <span class="o">&amp;</span> <span class="n">broker</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-field-meta-data-request-com">
<h2>Get Field Meta Data Request (COM)<a class="headerlink" href="#get-field-meta-data-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetFieldMetaData&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetFieldMetaData&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_FIELD_NAMES&quot;</span><span class="p">).</span><span class="n">AppendValue</span> <span class="s">&quot;EMSX_TICKER&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_FIELD_NAMES&quot;</span><span class="p">).</span><span class="n">AppendValue</span> <span class="s">&quot;EMSX_P_A&quot;</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetFieldMetaData&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">md</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">emsxFieldName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxDispName</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxType</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">emsxLevel</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">emsxLen</span> <span class="ow">As</span> <span class="kt">Integer</span>

                <span class="k">Set</span> <span class="n">md</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MetaData&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="k">Set</span> <span class="n">e</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">emsxFieldName</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_FIELD_NAME&quot;</span><span class="p">)</span>
                    <span class="n">emsxDispName</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_DISP_NAME&quot;</span><span class="p">)</span>
                    <span class="n">emsxType</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_TYPE&quot;</span><span class="p">)</span>
                    <span class="n">emsxLevel</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_LEVEL&quot;</span><span class="p">)</span>
                    <span class="n">emsxLen</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_LEN&quot;</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;MetaData: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxFieldName</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxDispName</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxType</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxLevel</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxLen</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="get-teams-request-com">
<h2>Get Teams Request (COM)<a class="headerlink" href="#get-teams-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GetTeams&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GetTeams&quot;</span><span class="p">)</span>

            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GetTeams&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">teams</span> <span class="ow">As</span> <span class="n">Element</span>
                <span class="k">Dim</span> <span class="n">team</span> <span class="ow">As</span> <span class="kt">String</span>
                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>

                <span class="k">Set</span> <span class="n">teams</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;TEAMS&quot;</span><span class="p">)</span>

                <span class="n">numValues</span> <span class="o">=</span> <span class="n">teams</span><span class="p">.</span><span class="n">numValues</span>

                <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">log</span> <span class="s">&quot;Team: &quot;</span> <span class="o">&amp;</span> <span class="n">team</span>

                <span class="k">Next</span> <span class="n">i</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="group-route-request-com">
<h2>Group Route Request (COM)<a class="headerlink" href="#group-route-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - GroupRoute&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">strategy</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">indicator</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">data</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;GroupRouteEx&quot;</span><span class="p">)</span>

            <span class="c">&#39;Multiple order numbers can be added</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Append</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741540</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Append</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741541</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Append</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741542</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT_PERCENT&quot;</span><span class="p">,</span> <span class="mi">100</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BMTB&quot;</span>

            <span class="c">&#39;For GroupRoute, the below values need to be added, but are taken</span>
            <span class="c">&#39;from the original order when the route is created.</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>  <span class="c">&#39;Use to identify the asset class of all orders</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BOOKNAME&quot;, &quot;HedgingBasket&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>
            <span class="c">&#39;req.Set &quot;EMSX_TRADER_UUID&quot;, 1234567</span>

            <span class="c">&#39;Set the Request Type if this is for multi-leg orders</span>
            <span class="c">&#39;only valid for options</span>

            <span class="c">&#39;Dim requestType As Element</span>
            <span class="c">&#39;</span>
            <span class="c">&#39;requestType = req.GetElement(&quot;EMSX_REQUEST_TYPE&quot;)</span>
            <span class="c">&#39;requestType.SetChoice &quot;Multileg&quot;</span>
            <span class="c">&#39;</span>
            <span class="c">&#39;Dim multileg As Element</span>
            <span class="c">&#39;multileg = requestType.GetElement(&quot;Multileg&quot;)</span>
            <span class="c">&#39;multileg.SetElement &quot;EMSX_AMOUNT&quot;, 10</span>
            <span class="c">&#39;multileg.GetElement(&quot;EMSX_ML_RATIO&quot;).AppendValue 2</span>
            <span class="c">&#39;multileg.GetElement(&quot;EMSX_ML_RATIO&quot;).AppendValue 3</span>

            <span class="c">&#39;Add the Route Ref ID values</span>
            <span class="k">Dim</span> <span class="n">routeRefIDPairs</span> <span class="ow">As</span> <span class="n">Element</span>
            <span class="k">Set</span> <span class="n">routeRefIDPairs</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_REF_ID_PAIRS&quot;</span><span class="p">)</span>

            <span class="k">Dim</span> <span class="n">route1</span> <span class="ow">As</span> <span class="n">Element</span>
            <span class="k">Set</span> <span class="n">route1</span> <span class="o">=</span> <span class="n">routeRefIDPairs</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">()</span>
            <span class="n">route1</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_ROUTE_REF_ID&quot;</span><span class="p">,</span> <span class="s">&quot;MyRouteRef1&quot;</span>
            <span class="n">route1</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741540</span>

            <span class="k">Dim</span> <span class="n">route2</span> <span class="ow">As</span> <span class="n">Element</span>
            <span class="k">Set</span> <span class="n">route2</span> <span class="o">=</span> <span class="n">routeRefIDPairs</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">()</span>
            <span class="n">route2</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_ROUTE_REF_ID&quot;</span><span class="p">,</span> <span class="s">&quot;MyRouteRef2&quot;</span>
            <span class="n">route2</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741541</span>

            <span class="k">Dim</span> <span class="n">route3</span> <span class="ow">As</span> <span class="n">Element</span>
            <span class="k">Set</span> <span class="n">route3</span> <span class="o">=</span> <span class="n">routeRefIDPairs</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">()</span>
            <span class="n">route3</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_ROUTE_REF_ID&quot;</span><span class="p">,</span> <span class="s">&quot;MyRouteRef3&quot;</span>
            <span class="n">route3</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741542</span>

            <span class="c">&#39;Below we establish the strategy details. Strategy details</span>
            <span class="c">&#39;are common across all orders in a GroupRoute operation.</span>
            <span class="k">Set</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_PARAMS&quot;</span><span class="p">)</span>
            <span class="n">strategy</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_STRATEGY_NAME&quot;</span><span class="p">,</span> <span class="s">&quot;VWAP&quot;</span>

            <span class="k">Set</span> <span class="n">indicator</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_FIELD_INDICATORS&quot;</span><span class="p">)</span>
            <span class="k">Set</span> <span class="n">data</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_FIELDS&quot;</span><span class="p">)</span>

            <span class="c">&#39;Strategy parameters must be appended in the correct order. See the output</span>
            <span class="c">&#39;of GetBrokerStrategyInfo request for the order. The indicator value is 0 for</span>
            <span class="c">&#39;a field that carries a value, and 1 where the field should be ignored</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;09:30:00&quot;</span>    <span class="c">&#39;StartTime</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;10:30:00&quot;</span>   <span class="c">&#39;EndTime</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;Max%Volume</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;%AMSession</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;OPG</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;MOC</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;CompletePX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;TriggerPX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;DarkComplete</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;DarkCompPX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;RefIndex</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;Discretion</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;GroupRouteEx&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">numValues</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">emsxRouteId</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">Element</span>

                <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">AsElement</span><span class="p">.</span><span class="n">HasElement</span><span class="p">(</span><span class="s">&quot;EMSX_SUCCESS_ROUTES&quot;</span><span class="p">)</span> <span class="k">Then</span>

                    <span class="k">Dim</span> <span class="n">success</span> <span class="ow">As</span> <span class="n">Element</span>

                    <span class="k">Set</span> <span class="n">success</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SUCCESS_ROUTES&quot;</span><span class="p">)</span>

                    <span class="n">numValues</span> <span class="o">=</span> <span class="n">success</span><span class="p">.</span><span class="n">numValues</span>

                    <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                        <span class="k">Set</span> <span class="n">e</span> <span class="o">=</span> <span class="n">success</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                        <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                        <span class="n">emsxRouteId</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">)</span>

                        <span class="n">log</span> <span class="s">&quot;Success: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">emsxRouteId</span>
                    <span class="k">Next</span> <span class="n">i</span>
                <span class="k">End</span> <span class="k">If</span>

                <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">AsElement</span><span class="p">.</span><span class="n">HasElement</span><span class="p">(</span><span class="s">&quot;EMSX_FAILED_ROUTES&quot;</span><span class="p">)</span> <span class="k">Then</span>

                    <span class="k">Dim</span> <span class="n">failed</span> <span class="ow">As</span> <span class="n">Element</span>

                    <span class="k">Set</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_FAILED_ROUTES&quot;</span><span class="p">)</span>

                    <span class="n">numValues</span> <span class="o">=</span> <span class="n">failed</span><span class="p">.</span><span class="n">numValues</span>

                    <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">numValues</span> <span class="o">-</span> <span class="mi">1</span>

                        <span class="k">Set</span> <span class="n">e</span> <span class="o">=</span> <span class="n">failed</span><span class="p">.</span><span class="n">GetValueAsElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                        <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                        <span class="n">errorCode</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                        <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                        <span class="n">log</span> <span class="s">&quot;Failed: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;, &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                    <span class="k">Next</span> <span class="n">i</span>
                <span class="k">End</span> <span class="k">If</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
<div class="section" id="route-extended-request-com">
<h2>Route Extended Request (COM)<a class="headerlink" href="#route-extended-request-com" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - Route&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;RouteEx&quot;</span><span class="p">)</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741193</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT&quot;</span><span class="p">,</span> <span class="mi">500</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_ROUTE_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>
            <span class="c">&#39;req.Set &quot;EMSX_TRADER_UUID&quot;, 1234567</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;Route&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">emsxRouteId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                <span class="n">emsxRouteId</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;EMSX_SEQUENCE: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;    EMSX_ROUTE_ID: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxRouteId</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="route-manually-request-com">
<h2>Route Manually Request (COM)<a class="headerlink" href="#route-manually-request-com" title="Permalink to this headline">¶</a></h2>
<div class="highlight-vb.net"><div class="highlight"><pre><span></span><span class="k">Option</span> <span class="n">Explicit</span>

<span class="k">Private</span> <span class="k">WithEvents</span> <span class="n">m_BBG_EMSX</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>
<span class="k">Public</span> <span class="n">running</span> <span class="ow">As</span> <span class="kt">Boolean</span>
<span class="k">Private</span> <span class="n">svc</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">service</span>
<span class="k">Private</span> <span class="n">emsxService</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Private</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">CorrelationId</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Initialize</span><span class="p">()</span>

    <span class="n">log</span> <span class="s">&quot;Bloomberg - EMSX API Example - RouteManually&quot;</span>

    <span class="n">emsxService</span> <span class="o">=</span> <span class="s">&quot;//blp/emapisvc_beta&quot;</span>

    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">New</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Session</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">True</span>

    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">QueueEvents</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Start</span>


<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Class_Terminate</span><span class="p">()</span>
    <span class="k">Set</span> <span class="n">m_BBG_EMSX</span> <span class="o">=</span> <span class="k">Nothing</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">m_BBG_EMSX_ProcessEvent</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">obj</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">)</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandler</span>

    <span class="k">Dim</span> <span class="n">eventObj</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span>

     <span class="c">&#39;   Assign the returned data to a Bloomberg type event</span>
    <span class="k">Set</span> <span class="n">eventObj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">If</span> <span class="n">Application</span><span class="p">.</span><span class="n">Ready</span> <span class="k">Then</span>

        <span class="k">Select</span> <span class="k">Case</span> <span class="n">eventObj</span><span class="p">.</span><span class="n">EventType</span>

            <span class="k">Case</span> <span class="n">SESSION_STATUS</span>
                <span class="n">processSessionEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">BLPSERVICE_STATUS</span>
                <span class="n">processServiceEvent</span> <span class="n">eventObj</span>

            <span class="k">Case</span> <span class="n">RESPONSE</span>
                <span class="n">processResponseEvent</span> <span class="n">eventObj</span>

        <span class="k">End</span> <span class="k">Select</span>

    <span class="k">End</span> <span class="k">If</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">errHandler</span><span class="p">:</span>
    <span class="k">Dim</span> <span class="n">errmsg</span> <span class="ow">As</span> <span class="kt">Variant</span>
    <span class="n">errmsg</span> <span class="o">=</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>
    <span class="n">log</span> <span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

<span class="k">End</span> <span class="k">Sub</span>


<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processSessionEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing SESSION_STATUS event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStarted&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Session started...&quot;</span>
            <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">OpenService</span> <span class="n">emsxService</span>
        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;SessionStartupFailure&quot;</span> <span class="k">Then</span>
            <span class="n">log</span> <span class="s">&quot;Error: Session startup failed&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">processServiceEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="n">req</span> <span class="ow">As</span> <span class="n">REQUEST</span>
    <span class="k">Dim</span> <span class="n">service</span> <span class="ow">As</span> <span class="n">service</span>
    <span class="k">Dim</span> <span class="n">strategy</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">indicator</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">data</span> <span class="ow">As</span> <span class="n">Element</span>
    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>

    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">failed</span>

    <span class="n">log</span> <span class="s">&quot;Processing SERVICE_STATUS event&quot;</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpened&quot;</span> <span class="k">Then</span>

            <span class="c">&#39; Get the service</span>
            <span class="k">Set</span> <span class="n">service</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">emsxService</span><span class="p">)</span>

            <span class="c">&#39;First, create our request object</span>
            <span class="k">Set</span> <span class="n">req</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">CreateRequest</span><span class="p">(</span><span class="s">&quot;RouteManuallyEx&quot;</span><span class="p">)</span>

            <span class="c">&#39;The fields below are mandatory</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">,</span> <span class="mi">3741495</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_AMOUNT&quot;</span><span class="p">,</span> <span class="mi">500</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_BROKER&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_HAND_INSTRUCTION&quot;</span><span class="p">,</span> <span class="s">&quot;ANY&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_ORDER_TYPE&quot;</span><span class="p">,</span> <span class="s">&quot;MKT&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TICKER&quot;</span><span class="p">,</span> <span class="s">&quot;IBM US Equity&quot;</span>
            <span class="n">req</span><span class="p">.</span><span class="n">Set</span> <span class="s">&quot;EMSX_TIF&quot;</span><span class="p">,</span> <span class="s">&quot;DAY&quot;</span>

            <span class="c">&#39;The fields below are optional</span>
            <span class="c">&#39;req.Set &quot;EMSX_ACCOUNT&quot;, &quot;TestAccount&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_BOOKNAME&quot;, &quot;HedgingBasket&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CFD_FLAG&quot;, &quot;1&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_ACCOUNT&quot;, &quot;ClrAccName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_CLEARING_FIRM&quot;, &quot;FirmName&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_EXEC_INSTRUCTIONS&quot;, &quot;AnyInst&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GET_WARNINGS&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_GTD_DATE&quot;, &quot;20170105&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_INVESTOR_ID&quot;, &quot;InvID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LIMIT_PRICE&quot;, 123.45</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_BROKER&quot;, &quot;BMTB&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_ID&quot;, &quot;SomeID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_LOCATE_REQ&quot;, &quot;Y&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_NOTES&quot;, &quot;Some notes&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ODD_LOT&quot;, &quot;0&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_ORDER_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_P_A&quot;, &quot;P&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_RELEASE_TIME&quot;, 34341</span>
            <span class="c">&#39;req.Set &quot;EMSX_REQUEST_SEQ&quot;, 1001</span>
            <span class="c">&#39;req.Set &quot;EMSX_ROUTE_REF_ID&quot;, &quot;UniqueID&quot;</span>
            <span class="c">&#39;req.Set &quot;EMSX_STOP_PRICE&quot;, 123.5</span>
            <span class="c">&#39;req.Set &quot;EMSX_TRADER_UUID&quot;, 1234567</span>

            <span class="c">&#39;Below we establish the strategy details. Strategy details</span>
            <span class="c">&#39;are common across all orders in a GroupRoute operation.</span>
            <span class="k">Set</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_PARAMS&quot;</span><span class="p">)</span>
            <span class="n">strategy</span><span class="p">.</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_STRATEGY_NAME&quot;</span><span class="p">,</span> <span class="s">&quot;VWAP&quot;</span>

            <span class="k">Set</span> <span class="n">indicator</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_FIELD_INDICATORS&quot;</span><span class="p">)</span>
            <span class="k">Set</span> <span class="n">data</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_STRATEGY_FIELDS&quot;</span><span class="p">)</span>

            <span class="c">&#39;Strategy parameters must be appended in the correct order. See the output</span>
            <span class="c">&#39;of GetBrokerStrategyInfo request for the order. The indicator value is 0 for</span>
            <span class="c">&#39;a field that carries a value, and 1 where the field should be ignored</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;09:30:00&quot;</span>    <span class="c">&#39;StartTime</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;10:30:00&quot;</span>   <span class="c">&#39;EndTime</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;Max%Volume</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;%AMSession</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;OPG</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;MOC</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;CompletePX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;TriggerPX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;DarkComplete</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;DarkCompPX</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;RefIndex</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">data</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_DATA&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>           <span class="c">&#39;Discretion</span>
            <span class="n">indicator</span><span class="p">.</span><span class="n">AppendElment</span><span class="p">().</span><span class="n">SetElement</span> <span class="s">&quot;EMSX_FIELD_INDICATOR&quot;</span><span class="p">,</span> <span class="mi">1</span>

            <span class="n">log</span> <span class="s">&quot;Request: &quot;</span> <span class="o">&amp;</span> <span class="n">req</span><span class="p">.</span><span class="n">Print</span>

            <span class="c">&#39; Send the request</span>
            <span class="k">Set</span> <span class="n">requestID</span> <span class="o">=</span> <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">SendRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ServiceOpenFailure&quot;</span> <span class="k">Then</span>

            <span class="n">log</span> <span class="s">&quot;Error: Service failed to open&quot;</span>
            <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

        <span class="k">End</span> <span class="k">If</span>

    <span class="k">Loop</span>

    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">failed</span><span class="p">:</span>

    <span class="n">log</span> <span class="s">&quot;Failed to send the request: &quot;</span> <span class="o">+</span> <span class="n">Err</span><span class="p">.</span><span class="n">Description</span>

    <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">Exit</span> <span class="k">Sub</span>

<span class="nf">End</span> <span class="k">Sub</span>

<span class="nf">Private</span> <span class="k">Sub</span> <span class="nf">processResponseEvent</span><span class="p">(</span><span class="n">evt</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">Event</span><span class="p">)</span>

    <span class="n">log</span> <span class="s">&quot;Processing RESPONSE event&quot;</span>

    <span class="k">Dim</span> <span class="n">it</span> <span class="ow">As</span> <span class="n">blpapicomLib2</span><span class="p">.</span><span class="n">MessageIterator</span>
    <span class="k">Dim</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Dim</span> <span class="n">errorCode</span> <span class="ow">As</span> <span class="kt">Long</span>
    <span class="k">Dim</span> <span class="n">errorMessage</span> <span class="ow">As</span> <span class="kt">String</span>

    <span class="k">Set</span> <span class="n">it</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">CreateMessageIterator</span><span class="p">()</span>

    <span class="c">&#39; Loop while we have messages remaining</span>
    <span class="k">Do</span> <span class="k">While</span> <span class="n">it</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="n">msg</span> <span class="ow">As</span> <span class="n">Message</span>

        <span class="c">&#39;   Pick up message</span>
        <span class="k">Set</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">Message</span>

        <span class="n">log</span> <span class="s">&quot;MessageType: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span>

        <span class="k">If</span> <span class="n">evt</span><span class="p">.</span><span class="n">EventType</span> <span class="o">=</span> <span class="n">RESPONSE</span> <span class="ow">And</span> <span class="n">msg</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">requestID</span><span class="p">.</span><span class="n">Value</span> <span class="k">Then</span>

            <span class="k">If</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;ErrorInfo&quot;</span> <span class="k">Then</span>

                <span class="n">errorCode</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_CODE&quot;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;ERROR_MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;ERROR CODE: &quot;</span> <span class="o">&amp;</span> <span class="n">errorCode</span> <span class="o">&amp;</span> <span class="s">&quot;    ERROR DESCRIPTION: &quot;</span> <span class="o">&amp;</span> <span class="n">errorMessage</span>

                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">ElseIf</span> <span class="n">msg</span><span class="p">.</span><span class="n">MessageTypeAsString</span> <span class="o">=</span> <span class="s">&quot;RouteManually&quot;</span> <span class="k">Then</span>

                <span class="k">Dim</span> <span class="n">emsxSequence</span> <span class="ow">As</span> <span class="kt">Long</span>
                <span class="k">Dim</span> <span class="n">emsxRouteId</span> <span class="ow">As</span> <span class="kt">Integer</span>
                <span class="k">Dim</span> <span class="n">msgdesc</span> <span class="ow">As</span> <span class="kt">String</span>

                <span class="n">emsxSequence</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_SEQUENCE&quot;</span><span class="p">)</span>
                <span class="n">emsxRouteId</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;EMSX_ROUTE_ID&quot;</span><span class="p">)</span>
                <span class="n">msgdesc</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">GetElement</span><span class="p">(</span><span class="s">&quot;MESSAGE&quot;</span><span class="p">)</span>

                <span class="n">log</span> <span class="s">&quot;EMSX_SEQUENCE: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxSequence</span> <span class="o">&amp;</span> <span class="s">&quot;    EMSX_ROUTE_ID: &quot;</span> <span class="o">&amp;</span> <span class="n">emsxRouteId</span> <span class="o">&amp;</span> <span class="s">&quot;    MESSAGE: &quot;</span> <span class="o">&amp;</span> <span class="n">msgdesc</span>

                <span class="n">m_BBG_EMSX</span><span class="p">.</span><span class="n">Stop</span>
                <span class="n">running</span> <span class="o">=</span> <span class="k">False</span>

            <span class="k">End</span> <span class="k">If</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">Loop</span>

<span class="k">End</span> <span class="k">Sub</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="requestResponseSsCOM.html" class="btn btn-neutral float-right" title="Sell-Side Request/Response Service (COM)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Excel COM" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Terrence C. Kim.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>